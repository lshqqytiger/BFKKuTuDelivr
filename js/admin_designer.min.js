/**
Rule the words! KKuTu Online
Copyright (C) 2017 JJoriping(op@jjo.kr)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see <http://www.gnu.org/licenses/>.
*/


!(function() {
	let isHacker = true;
	var _setInterval = window.setInterval;
	var $Request = window.$Request;
	
	function a(a, b, c) {
		return $("<input>").attr("id", a).css("width", f[b]).val(c)
	}

	function b(b, c, d, e, f) {
		return a("word-" + [b, c, d, e].join("-"), e, f)
	}

	function c(a, b, c) {
		var e = ["wa", a, b, c].join("-") + "-";
		return $("<td>").append($("<button>").attr("id", e + "u").css("float", "left").html("▲").on("click", d)).append($("<button>").attr("id", e + "x").css("float", "left").html("X").on("click", d)).append($("<button>").attr("id", e + "e").css("float", "left").html("?").on("click", d)).append($("<button>").attr("id", e + "d").css("float", "left").html("▼").on("click", d))
	}

	function d(a) {
		var b, c = $(a.currentTarget).attr("id").slice(3).split("-"),
			d = c.pop(),
			f = $("#wr-" + c.join("-"));
		switch (d) {
			case "u":
				a.shiftKey && (e(f, f.prev().attr("id").slice(3)), e(f.prev(), c.join("-"))), f.prev().before(f);
				break;
			case "x":
				f.remove();
				break;
			case "e":
				(b = prompt("새 key")) && e(f, b);
				break;
			case "d":
				a.shiftKey && (e(f, f.next().attr("id").slice(3)), e(f.next(), c.join("-"))), f.next().after(f)
		}
	}

	function e(a, b) {
		var c = a.attr("id").slice(3);
		a.attr("id", "wr-" + b).children("td").first().html(b), a.find("*").each(function(a, d) {
			var e = $(d);
			e.attr("id") && -1 != e.attr("id").indexOf(c) && e.attr("id", e.attr("id").replace(c, b))
		})
	}
	var f = {
			y: 50,
			t: 50,
			g: 100,
			l: 200,
			m: 600
		},
		g = {};
	$(document).ready(function() {
		delete window.$Request;
		$("#shop-go-view").on("click", function(b) {
			$.get("/gwalli/shop/" + $("#shop-word-view").val(), function(b) {
				var c, d, e = $("#shop-data-view").empty();
				b.goods.forEach(function(b) {
					e.append(d = $("<tr>").attr("id", ["gu", b._id].join("-"))), d.append($("<td>").append(a("si-" + b._id + "-_id", "g", b._id))).append($("<td>").append(a("si-" + b._id + "-cost", "y", b.cost))).append($("<td>").append(a("si-" + b._id + "-hit", "y", b.hit))).append($("<td>").append(a("si-" + b._id + "-term", "y", b.term))).append($("<td>").append(a("si-" + b._id + "-group", "y", b.group))).append($("<td>").append(a("si-" + b._id + "-updatedAt", "y", b.updatedAt))).append($("<td>").append(a("si-" + b._id + "-options", "l", JSON.stringify(b.options || {})))).append($("<td>").append(a("si-" + b._id + "-name_ko_KR", "l"))).append($("<td>").append(a("si-" + b._id + "-desc_ko_KR", "l"))).append($("<td>").append(a("si-" + b._id + "-name_en_US", "l"))).append($("<td>").append(a("si-" + b._id + "-desc_en_US", "l")))
				}), b.desc.forEach(function(a) {
					var b = a._id.replace("$", "\\$");
					for (c in a) "_id" != c && $("#si-" + b + "-" + c).val(a[c])
				}), $('#shop-data-view').find('input').attr('readonly', true);
			})
		})
	});
	$(document).ready(function() {
		delete window.$Request;
		$("#shop-go").on("click", function(b) {
			$.get("/gwalli/shop/" + $("#shop-word").val(), function(b) {
				var c, d, e = $("#shop-data").empty();
				b.goods.forEach(function(b) {
					e.append(d = $("<tr>").attr("id", ["gu", b._id].join("-"))), d.append($("<td>").append(a("si-" + b._id + "-_id", "g", b._id))).append($("<td>").append(a("si-" + b._id + "-cost", "y", b.cost))).append($("<td>").append(a("si-" + b._id + "-hit", "y", b.hit))).append($("<td>").append(a("si-" + b._id + "-term", "y", b.term))).append($("<td>").append(a("si-" + b._id + "-group", "y", b.group))).append($("<td>").append(a("si-" + b._id + "-updatedAt", "y", b.updatedAt))).append($("<td>").append(a("si-" + b._id + "-options", "l", JSON.stringify(b.options || {})))).append($("<td>").append(a("si-" + b._id + "-name_ko_KR", "l"))).append($("<td>").append(a("si-" + b._id + "-desc_ko_KR", "l"))).append($("<td>").append(a("si-" + b._id + "-name_en_US", "l"))).append($("<td>").append(a("si-" + b._id + "-desc_en_US", "l")))
				}), b.desc.forEach(function(a) {
					var b = a._id.replace("$", "\\$");
					for (c in a) "_id" != c && $("#si-" + b + "-" + c).val(a[c])
				})
			})
		}), $("#shop-hide").on("click", function(a) {
			$("#shop-data tr:not(.gu-new)").toggle()
		}), $("#shop-add").on("click", function(b) {
			var c = prompt("식별자");
			c && $("#shop-data").append($("<tr>").attr("id", "gu-" + c).addClass("gu-new").append($("<td>").append(a("si-" + c + "-_id", "g", c))).append($("<td>").append(a("si-" + c + "-cost", "y"))).append($("<td>").append(a("si-" + c + "-hit", "y"))).append($("<td>").append(a("si-" + c + "-term", "y"))).append($("<td>").append(a("si-" + c + "-group", "y"))).append($("<td>").append(a("si-" + c + "-updatedAt", "y"))).append($("<td>").append(a("si-" + c + "-options", "l", "{}"))).append($("<td>").append(a("si-" + c + "-name_ko_KR", "l"))).append($("<td>").append(a("si-" + c + "-desc_ko_KR", "l"))).append($("<td>").append(a("si-" + c + "-name_en_US", "l"))).append($("<td>").append(a("si-" + c + "-desc_en_US", "l"))))
		}), $("#shop-apply").on("click", function(a) {
			var b = [];
			$("#shop-data tr:visible").each(function(a, c) {
				var d = $(c).find("td>input");
				b.push({
					_id: d.get(0).value,
					core: {
						cost: d.get(1).value,
						hit: d.get(2).value || 0,
						term: d.get(3).value || 0,
						group: d.get(4).value,
						updatedAt: d.get(5).value || (new Date).getTime(),
						options: d.get(6).value
					},
					text: {
						name_ko_KR: d.get(7).value,
						desc_ko_KR: d.get(8).value,
						name_en_US: d.get(9).value,
						desc_en_US: d.get(10).value
					}
				})
			}), $.post("/gwalli/shop", {
				list: JSON.stringify({
					list: b
				}),
				pw: $("#db-password").val()
			}, function(a) {
				alert(a)
			})
		}), $("#shop-give").on("click", function(a){
			$.post("/gwalli/shopGIIL", {
				list: $("#shop-users").val(),
				item: $("#shop-item-give").val(),
				pw: $("#db-password").val()
			}, function(b){
				alert(b.result)
			})
		})
	});
	$(document).ready(function() {
		delete window.$Request;
		$("#shop-go-remove").on("click", function(b) {
			if($("#shop-word-remove").val().includes("~")) alert("전체 조회 기능은 사용할 수 없습니다."), $("#shop-word-remove").val("");
			$.get("/gwalli/shop/" + $("#shop-word-remove").val(), function(b) {
				var c, d, e = $("#shop-data-remove").empty();
				b.goods.forEach(function(b) {
					e.append(d = $("<tr>").attr("id", ["gu", b._id].join("-"))), d.append($("<td>").append(a("si-" + b._id + "-_id", "g", b._id))).append($("<td>").append(a("si-" + b._id + "-group", "y", b.group))).append($("<td>").append(a("si-" + b._id + "-name_ko_KR", "l"))).append($("<td>").append(a("si-" + b._id + "-desc_ko_KR", "l")))
				}), b.desc.forEach(function(a) {
					var b = a._id.replace("$", "\\$");
					for (c in a) "_id" != c && $("#si-" + b + "-" + c).val(a[c])
				}), $('#shop-data-remove').find('input').attr('readonly', true)
			}), $("#shop-remove").on("click", function(a) {
				var b = [];
				var d = $("#shop-data-remove").find("input");
				b.push({
					_id: d.get(0).value,
					core: {
						group: d.get(1).value
					},
					text: {
						name_ko_KR: d.get(2).value,
						desc_ko_KR: d.get(3).value
					}
				}), $.post("/gwalli/shopditem", {
					list: JSON.stringify({
						list: b
					}),
					pw: $("#db-password").val()
				}, function(a) {
					alert(`Removed item ${a._id}`)
					$("#shop-data-remove").empty();
				})
			})
		})
	});
	
	// Block the Devtools
	$Request('devtools', () => {
		alert("개발자 도구(F12)는 보안상의 이유로 사용하실 수 없습니다.");
		
		$("#Middle").html("<center><h1><br/><font color='black'>잘못된 접근입니다.</font></h1></center>");
		$("#Bottom").remove();
	})
})();
$(document).ready(function() {
	$(document).on("contextmenu dragstart selectstart", function(e) {
		return false;
	});
});